openapi: 3.0.0
info:
  version: 0.0.1
  title: Health Data Consent Manager
  description: >
    Entity which provides health information aggregation services to customers of health care services.
    It enables customers to fetch their health information from one or more Health Information Providers
    (e.g., Hospitals, Diagnostic Labs, Medical Device Companies), based on their explicit Consent and to share such
    aggregated information with Health Information Users i.e. entities in need of such data (e.g., Insurers,
    Doctors, Medical Researchers).

servers:
  - url: https://ncg-dev.projecteka.in/consent-manager
    description: Dev

tags:
  - name: discovery
  - name: link
  - name: consent
  - name: data flow
  - name: account

paths:
  # discovery service
  /patients/discover/carecontexts:
    post:
      tags:
        - discovery
      summary: Discover patient
      description: >
        Return only one patient record with (potentially masked) associated care contexts
        1. **At least one of the verified identifier matches.**
        2. **Filter out records using unverified, firstName, secondName, gender and dob
        if there are more than one patient records found from step 1.**
      operationId: discoverPatient
      parameters:
        - $ref: "#/components/parameters/authorization"
      requestBody:
        required: true
        description: A patient discovery request.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatientDiscoveryRequest'
          application/xml:
            schema:
              $ref: '#/components/schemas/PatientDiscoveryRequest'
      responses:
        '200':
          description: Found a patient.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatientDiscoveryRepresentation'
            application/xml:
              schema:
                $ref: '#/components/schemas/PatientDiscoveryRepresentation'
        '401':
          description: >
            **Causes:**
              * Unauthorized request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream system(s) is down.
              * Unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: >
            **Causes:**
              * No Patients found in HIP
              * Multiple patients found in HIP
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /patients/links:
    get:
      tags:
        - link
      summary: Get linked care contexts
      description: >
        Get all linked care contexts from all HIPs for a patient.
        This api is to be consumed by patient.
      parameters:
        - $ref: "#/components/parameters/authorization"
      responses:
        '200':
          description: All linked care contexts of a patient.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LinkedCareContexts'
            application/xml:
              schema:
                $ref: '#/components/schemas/LinkedCareContexts'
        '401':
          description: >
            **Causes:**
              * Expired/Invalid token.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream system(s) is down.
              * Unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /patients/link:
    post:
      tags:
        - link
      summary: Link care contexts
      description: >
        Links care contexts associated with only one patient
          1. **Validates Transaction Id**
      operationId: linkPatient
      parameters:
        - $ref: "#/components/parameters/authorization"
      requestBody:
        required: true
        description: A object
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatientLinkReferenceRequest'
          application/xml:
            schema:
              $ref: '#/components/schemas/PatientLinkReferenceRequest'
      responses:
        '200':
          description: A successful link request.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatientLinkReferenceResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/PatientLinkReferenceResponse'
        '400':
          description: >
            **Causes:**
              * Account reference number is invalid
              * Care context reference numbers are invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: >
            **Causes:**
              * Expired/Invalid token.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream system(s) is down.
              * Unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /patients/link/{linkRefNumber}:
    post:
      tags:
        - link
      summary: Verify link
      description: >
        Returns a list of linked care contexts with patient reference number.
          1. **Validate token for expiry**
          3. **Returns a list of unmasked linked care contexts with patient reference number**
      operationId: linkPatientConfirmation
      parameters:
        - $ref: "#/components/parameters/authorization"
        - $ref: "#/components/parameters/linkRefNumber"
      requestBody:
        required: true
        description: A object
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatientLinkRequest'
          application/xml:
            schema:
              $ref: '#/components/schemas/PatientLinkRequest'
      responses:
        '200':
          description: List of linked care contexts of a patient with patient reference number.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatientLinkResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/PatientLinkResponse'
        '400':
          description: >
            **Causes:**
              * Link reference number is invalid
              * Token is invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: >
            **Causes:**
              * Expired/Invalid token.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream system(s) is down.
              * Unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /providers:
    get:
      tags:
        - discovery
      summary: List providers
      description: >
        Returns a list of linked care contexts with patient reference number.
          1. **Validate token for expiry**
          3. **Returns a list of providers which contains the name**
      operationId: listProviders
      parameters:
        - $ref: "#/components/parameters/authorization"
        - $ref: "#/components/parameters/providerName"
      responses:
        '200':
          description: List of health information providers.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProvidersRepresentation'
            application/xml:
              schema:
                $ref: '#/components/schemas/ProvidersRepresentation'
        '500':
          description: >
            **Causes:**
              * Downstream system(s) is down.
              * Unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /providers/{provider-id}:
    get:
      tags:
        - discovery
      summary: Get a specific provider
      description: >
        Returns a provider
          1. **Validate token for expiry**
          3. **Returns a provider associated with the given id**
      operationId: fetchProvider
      parameters:
        - $ref: "#/components/parameters/authorization"
        - name: provider-id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: A provider.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProviderRepresentation'
            application/xml:
              schema:
                $ref: '#/components/schemas/ProviderRepresentation'
        '401':
          description:  >
            **Causes:**
              * Expired/Invalid token.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Provider doesn't exist.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream system(s) is down.
              * Unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  # consent-service
  /consent-requests:
    post:
      tags:
        - consent
      summary: Create consent request
      description: Creates a consent request to get data about a patient by HIU user.
      operationId: createConsentRequest
      parameters:
        - $ref: '#/components/parameters/hiuAuthorization'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConsentRequest'
          application/xml:
            schema:
              $ref: '#/components/schemas/ConsentRequest'
      responses:
        '200':
          description: Successful creation of consent request
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
            application/xml:
              schema:
                type: object
                properties:
                  consentRequest:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
        '400':
          description:  >
            **Causes:**
              * Invalid data being sent such as patient doesn't exist in the system.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description:  >
            **Causes:**
              * Expired/Invalid token.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream system(s) is down.
              * Unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    get:
      tags:
        - consent
      summary: List consent requests
      description: Return list of consent requests which are matching filter criteria.
      operationId: listConsentRequests
      parameters:
        - $ref: '#/components/parameters/authorization'
        - $ref: '#/components/parameters/limit'
        - $ref: '#/components/parameters/offset'
        - $ref: '#/components/parameters/filters'
      responses:
        '200':
          description: List of consent requests.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsentRequestsRepresentation'
            application/xml:
              schema:
                $ref: '#/components/schemas/ConsentRequestsRepresentation'
        '401':
          description:  >
            **Causes:**
              * Expired/Invalid token.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream system(s) is down.
              * Unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /consent-requests/{request-id}/approve:
    post:
      tags:
        - consent
      summary: Approve Request
      description: User approves the consent request with preferred data access parameters.
      parameters:
        - name: Authorization
          description: Token received after successful verification of PIN
          in: header
          required: true
          schema:
            type: string
        - name: request-id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConsentsApproveRequest'
          application/xml:
            schema:
              $ref: '#/components/schemas/ConsentsApproveRequest'
      responses:
        '200':
          description: Successful creation of consent artefact.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsentApprovalRepresentation'
            application/xml:
              schema:
                $ref: '#/components/schemas/ConsentApprovalRepresentation'
        '409':
          description: Consent request already in approved status.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Consent request doesn't exist.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description:  >
            **Causes:**
              * Expired/Invalid token.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream system(s) is down.
              * Unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /consent-requests/{request-id}/deny:
    post:
      tags:
        - consent
      summary: Deny request.
      description: Deny consent request.
      parameters:
        - $ref: '#/components/parameters/authorization'
        - name: request-id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConsentDenyRequest'
          application/xml:
            schema:
              $ref: '#/components/schemas/ConsentDenyRequest'
      responses:
        '204':
          description: Successfully denied consent request.
        '409':
          description: Consent request already in denied status.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Consent request doesn't exist.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description:  >
            **Causes:**
              * Expired/Invalid token.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream system(s) is down.
              * Unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /consents/{consent-id}:
    get:
      tags:
        - consent
      summary: Get a specific consent
      description: Fetch a consent artefact associated with the consent-id
      operationId: fetchConsentArtefact
      parameters:
        - $ref: '#/components/parameters/hiuAuthorization'
        - name: consent-id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: a consent artefact.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsentArtefactRepresentation'
            application/xml:
              schema:
                $ref: '#/components/schemas/ConsentArtefactRepresentation'
        '404':
          description: Consent artefact doesn't exist.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description:  >
            **Causes:**
              * Expired/Invalid token.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream system(s) is down.
              * Unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /consent-requests/{consent-request-id}/consent-artefacts:
    get:
      tags:
        - consent
      summary: Gets list of consents given a request id
      description: Fetch a consent artefact associated with the consent-request-id
      operationId: consentArtefacts
      parameters:
        - $ref: '#/components/parameters/authorization'
        - name: consent-request-id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: list of consent artefacts.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsentArtefacts'
            application/xml:
              schema:
                $ref: '#/components/schemas/ConsentArtefacts'
        '404':
          description: Consent request doesn't exist.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description:  >
            **Causes:**
              * Expired/Invalid token.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream system(s) is down.
              * Unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /health-information/request:
    post:
      tags:
        - data flow
      summary: Request for health information
      description: The HIU submits the Consent Artefact ID of the consent required for fetching helath information from the HIP(s). A transaction ID is generated and returned.
      parameters:
        - $ref: '#/components/parameters/hiuAuthorization'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HealthInformationRequest'
          application/xml:
            schema:
              $ref: '#/components/schemas/HealthInformationRequest'
      responses:
        '200':
          description: A transaction ID is generated and returned.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthInformationRequestResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/HealthInformationRequestResponse'
        '400':
          description: >
            **Causes:**
              * Consent artefact Id is invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: >
            **Causes:**
              * Unauthorized HIU
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream system(s) is down.
              * Unhandled exceptions.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /patients/enquiries:
    post:
      tags:
        - account
      summary: Enquire identifier.
      description: Enquire the identifier [Mobile] of a patient.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MobileNumberEnquiryRequest'
          application/xml:
            schema:
              $ref: '#/components/schemas/MobileNumberEnquiryRequest'
      responses:
        '200':
          description: A session ID is returned and OTP will be sent to user mobile number.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IdentifierEnquiryResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/IdentifierEnquiryResponse'
        '400':
          description: >
            **Causes:**
              * Invalid Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream services are down
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /patients/enquiries/{enquiryId}/verify:
    post:
      tags:
        - account
      summary: Verify identifier.
      description: Verify the identifier of a patient by validating an OTP.
      parameters:
        - $ref: '#/components/parameters/enquiryId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MobileNumberVerifyRequest'
          application/xml:
            schema:
              $ref: '#/components/schemas/MobileNumberVerifyRequest'
      responses:
        '200':
          description: A temporary token which will allow the user to create their profile.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IdentifierVerifyResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/IdentifierVerifyResponse'
        '400':
          description: >
            **Causes:**
              * Invalid Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: >
            **Causes:**
              * OTP is invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream services are down
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /patients/me:
    get:
      tags:
        - account
      summary: Get profile.
      description: Logged in patient profile information.
      parameters:
        - $ref: '#/components/parameters/authorization'
      responses:
        '200':
          description: A profile of a patient.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PatientProfileRepresentation'
            application/xml:
              schema:
                $ref: '#/components/schemas/PatientProfileRepresentation'
        '401':
          description: >
            **Causes:**
              * Token is invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream services are down
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /patients/pin:
    post:
      tags:
        - account
      summary: Create transaction pin
      description: Create transaction pin to use it while granting consent.
      parameters:
        - $ref: '#/components/parameters/authorization'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePinRequest'
          application/xml:
            schema:
              $ref: '#/components/schemas/CreatePinRequest'
      responses:
        '204':
          description: PIN created successfully.
        '401':
          description: >
            **Causes:**
              * Token is invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream services are down
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /patients/verify-pin:
    post:
      tags:
        - account
      summary: Verify PIN
      description: MFA before granting the consent request.
      parameters:
        - $ref: '#/components/parameters/authorization'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidatePinRequest'
          application/xml:
            schema:
              $ref: '#/components/schemas/ValidatePinRequest'
      responses:
        '200':
          description: Successful verification of PIN.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IdentifierVerifyResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/IdentifierVerifyResponse'
        '401':
          description: >
            **Causes:**
              * Token is invalid
              * PIN is invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream services are down
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /patients/profile:
    post:
      tags:
        - account
      summary: Create Account
      description: Patient can create an account once they verified one of the identifiers.
      parameters:
        - name: Authorization
          description: Token received after successful verification of identifier.
          in: header
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePatientRequest'
          application/xml:
            schema:
              $ref: '#/components/schemas/CreatePatientRequest'
      responses:
        '200':
          description: Profile created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: >
            **Causes:**
              * Invalid Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: >
            **Causes:**
              * Invalid/expired token.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream services are down
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /consents/revoke:
    post:
      tags:
        - consent
      summary: Revoke consents
      description: Patient revoke consents which are given earlier to HIU.
      parameters:
        - name: Authorization
          description: Token received after successful verification of PIN
          in: header
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RevokeRequest'
          application/xml:
            schema:
              $ref: '#/components/schemas/RevokeRequest'
      responses:
        '204':
          description: Successful revocation of list of consents.
        '404':
          description: >
            **Causes:**
              * One or more consents does not exist.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: >
            **Causes:**
              * One or more consents are already revoked.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: >
            **Causes:**
              * Token is invalid
              * PIN is invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: >
            **Causes:**
              * Downstream services are down
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /health-information/notification:
    post:
      tags:
        - notification
      description: Notifications corresponding to events during data flow
      parameters:
        - $ref: '#/components/parameters/hiuAuthorization'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HINotification'
          application/xml:
            schema:
              $ref: '#/components/schemas/HINotification'
      responses:
        '204':
          description: Notification is Accepted
        '400':
          description: >
            **Causes:**
              * Invalid Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  # Sessions
  /logout:
    post:
      description: |
        Logout active user by invalidating the access and refresh tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogoutRequest'
          application/xml:
            schema:
              $ref: '#/components/schemas/LogoutRequest'
      responses:
        200:
          description: OK
        401:
          description: Unauthorized
        400:
          description: Bad request(potentially bad request token)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
            application/xml:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Error(On server side) in logging out

components:
  parameters:
    authorization:
      name: Authorization
      in: header
      required: true
      description: Bearer token which was issued after successful login.
      schema:
        type: string
    hiuAuthorization:
      name: Authorization
      in: header
      required: true
      description: Authorization token which was issued by central registery.
      schema:
        type: string
    limit:
      name: limit
      in: query
      description: How many items to return at one time (max 100) (recommended to sent always)
      required: false
      schema:
        type: integer
        format: int32
    offset:
      name: offset
      in: query
      description: How many items out of line.
      required: false
      schema:
        type: integer
        format: int32
    filters:
      name: filters
      in: query
      schema:
        type: string
      description: >
        1. Query string parameter restricts the data returned from your request.
        2. Values in filters need to be encoded.
            | filter   | logic|
            | ------- | ----------------    |
            | status%21%3DDENIED     | status != DENIED  |
            | status%3D%3DDENIED,status%3D%3DGRANTED  | status == DENIED **or** status == GRANTED |
      examples:
        except_denied:
          value: "filters=cm:status%21%3DDENIED"
        either_granted_or_denied:
          value: "filters=cm:status%3D%3DDENIED,cm:status%3D%3DGRANTED"
      required: false
    linkRefNumber:
      name: linkRefNumber
      in: path
      schema:
        type: string
        format: uuid
      required: true
    providerName:
      name: name
      in: query
      schema:
        type: string
        example: max
      required: true
    enquiryId:
      name: enquiryId
      in: path
      schema:
        type: string
        format: uuid
      required: true
  schemas:
    PatientDiscoveryRepresentation:
      type: object
      properties:
        transactionId:
          type: string
          format: uuid
        patient:
          $ref: '#/components/schemas/PatientRepresentation'
        createdAt:
          type: string
          format: date-time
    PatientRepresentation:
      type: object
      properties:
        referenceNumber:
          type: string
        display:
          type: string
        careContexts:
          type: array
          items:
            $ref: '#/components/schemas/CareContextRepresentation'
          xml:
            wrapped: true
      xml:
        name: PatientRepresentation
    Patient:
      type: object
      properties:
        referenceNumber:
          type: string
        careContexts:
          type: array
          items:
            $ref: '#/components/schemas/CareContext'
          xml:
            wrapped: true
      xml:
        name: Patient
    CareContextRepresentation:
      type: object
      properties:
        referenceNumber:
          type: string
        display:
          type: string
      xml:
        name: CareContextResponse
    CareContext:
      type: object
      properties:
        referenceNumber:
          type: string
      xml:
        name: CareContext
    PatientDiscoveryRequest:
      type: object
      properties:
        hip:
          type: object
          properties:
            id:
              type: string
              description: Identifier of the health information provider where patient record needs to be looked up.
        unverifiedIdentifiers:
          description: additional unverified identifiers may be passed
          type: array
          items:
            $ref: '#/components/schemas/PatientIdentifier'
          xml:
            name: unverifiedIdentifiers
            wrapped: true
    PatientLinkReferenceRequest:
      type: object
      properties:
        transactionId:
          type: string
        patient:
          $ref: '#/components/schemas/Patient'
      xml:
        name: PatientLinkReferenceRequest
    PatientLinkReferenceResponse:
      type: object
      properties:
        transactionId:
          type: string
        link:
          $ref: '#/components/schemas/link'
      xml:
        name: PatientLinkReferenceResponse
    link:
      type: object
      properties:
        referenceNumber:
          type: string
        authenticationType:
          type: string
          enum: ['DIRECT', 'MEDIATED']
        meta:
          $ref: '#/components/schemas/Meta'
      xml:
        name: link
    Meta:
      type: object
      required:
        - communicationMedium
        - communicationHint
      properties:
        communicationMedium:
          type: string
          enum: ['M0BILE', 'EMAIL']
        communicationHint:
          type: string
        communicationExpiry:
          type: string
          example: "2019-12-30T12:01:55Z"
      xml:
        name: Meta
    PatientLinkRequest:
      type: object
      properties:
        token:
          type: string
      xml:
        name: PatientLinkRequest
    PatientLinkResponse:
      type: object
      properties:
        patient:
          $ref: '#/components/schemas/PatientRepresentation'
      xml:
        name: PatientLinkResponse
    ErrorResponse:
      type: object
      properties:
        error:
          $ref: '#/components/schemas/Error'
      xml:
        name: ErrorResponse
    Error:
      type: object
      properties:
        code:
          type: integer
          enum: [1000, 10001]
          description: >
            1. Error code 1000 : No patient found
            2. Error code 1001: Multiple patients found
        message:
          type: string
      xml:
        name: Error
    ConsentRequestsRepresentation:
      type: object
      properties:
        limit:
          type: integer
        size:
          type: integer
        offset:
          type: integer
        requests:
          type: array
          maxItems: 100
          items:
            $ref: '#/components/schemas/ConsentRequestRepresentation'
          xml:
            wrapped: true
      xml:
        name: ConsentRequestsResponse
    ConsentRequestRepresentation:
      type: object
      required:
        - createdAt
        - purpose
        - patient
        - hiu
        - permission
        - status
      properties:
        id:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        lastUpdated:
          type: string
          format: date-time
        purpose:
          $ref: "#/components/schemas/UsePurpose"
        patient:
          allOf:
            - $ref: '#/components/schemas/ConsentManagerPatientID'
            - xml:
                name: patient
        hip:
          type: object
          allOf:
            - $ref: '#/components/schemas/OrganizationRepresentation'
            - xml:
                name: hip
        hiu:
          type: object
          allOf:
            - $ref: '#/components/schemas/OrganizationRepresentation'
            - xml:
                name: hiu
        requester:
          $ref: '#/components/schemas/Requester'
        hiTypes:
          type: array
          items:
            $ref: '#/components/schemas/HITypeEnum'
          xml:
            wrapped: true
        permission:
          $ref: '#/components/schemas/Permission'
        status:
          $ref: '#/components/schemas/ConsentStatus'
      xml:
        name: ConsentRequestResponse
    Requester:
      type: object
      required:
        - name
      properties:
        name:
          type: string
        identifier:
          $ref: '#/components/schemas/Identifier'
    OrganizationRepresentation:
      type: object
      required:
        - id
      properties:
        id:
          type: string
          xml:
            attribute: true
      xml:
        name: OrganizationResponse
    Organization:
      type: object
      required:
        - id
      properties:
        id:
          type: string
          xml:
            attribute: true
    Identifier:
      type: object
      required:
        - value
      properties:
        value:
          type: string
        type:
          type: string
        system:
          type: string
          format: uri
    HITypeEnum:
      type: string
      enum:
        - Condition
        - Observation
        - MedicationRequest
        - DiagnosticReport
      xml:
        name: HIType
    ConsentsApproveRequest:
      type: object
      properties:
        consents:
          type: array
          items:
            $ref: '#/components/schemas/ConsentApproveRequest'
          xml:
            wrapped: true
    ConsentApproveRequest:
      type: object
      properties:
        hiTypes:
          type: array
          items:
            $ref: '#/components/schemas/HITypeEnum'
          xml:
            wrapped: true
        hip:
          type: object
          allOf:
            - $ref: '#/components/schemas/Organization'
            - xml:
                name: hip
        careContexts:
          type: array
          items:
            type: object
            required:
              - patientReference
              - careContextReference
            properties:
              patientReference:
                type: string
              careContextReference:
                type: string
        permission:
          $ref: '#/components/schemas/Permission'
      xml:
        name: ConsentApproveRequest
    ConsentApprovalRepresentation:
      type: object
      properties:
        consents:
          type: array
          items:
            $ref: '#/components/schemas/Consent'
          xml:
            wrapped: true
      xml:
        name: ConsentApprovalResponse
    Consent:
      type: object
      properties:
        id:
          type: string
          format: uuid
      xml:
        name: Consent
    Permission:
      type: object
      properties:
        accessMode:
          type: string
          enum: [VIEW, STORE, QUERY, STREAM]
        dateRange:
          type: object
          properties:
            from:
              type: string
              format: date-time
            to:
              type: string
              format: date-time
        dataEraseAt:
          type: string
          format: date-time
        frequency:
          type: object
          properties:
            unit:
              type: string
              enum: [HOUR, WEEK, DAY, MONTH, YEAR]
            value:
              type: integer
            repeats:
              type: integer
      xml:
        name: Permission
    ProvidersRepresentation:
      type: array
      items:
        $ref: '#/components/schemas/ProviderRepresentation'
      xml:
        name: ProvidersResponse
    ProviderRepresentation:
      type: object
      properties:
        identifier:
          allOf:
            - $ref: '#/components/schemas/OrganizationRepresentation'
        city:
          type: string
        telephone:
          type: string
        type:
          type: string
    ConsentRequest:
      type: object
      properties:
        consent:
          type: object
          required:
            - purpose
            - patient
            - hiu
            - requester
            - hiTypes
            - permission
            - consentNotificationUrl
          properties:
            purpose:
              $ref: '#/components/schemas/UsePurpose'
            patient:
              type: object
              allOf:
                - $ref: '#/components/schemas/ConsentManagerPatientID'
                - xml:
                    name: patient
            hip:
              type: object
              allOf:
                - $ref: '#/components/schemas/OrganizationRepresentation'
                - xml:
                    name: hip
            hiu:
              type: object
              allOf:
                - $ref: '#/components/schemas/OrganizationRepresentation'
                - xml:
                    name: hiu
            requester:
              $ref: '#/components/schemas/Requester'
            hiTypes:
              type: array
              items:
                $ref: '#/components/schemas/HITypeEnum'
            permission:
              $ref: '#/components/schemas/Permission'
            consentNotificationUrl:
              type: string
              example: 'http://localhost:8003/consent/notification'
    ConsentManagerPatientID:
      type: object
      properties:
        id:
          type: string
          xml:
            attribute: true
          format: <user-id>@<ncg-id>
          example: batman@ncg
    LinkedCareContexts:
      type: object
      properties:
        patient:
          $ref: '#/components/schemas/patient'
    patient:
      type: object
      required:
        - id
      properties:
        id:
          type: string
        links:
          type: array
          items:
            $ref: '#/components/schemas/links'
    links:
      type: object
      properties:
        hip:
          $ref: '#/components/schemas/hip'
        referenceNumber:
          type: string
        display:
          type: string
        careContexts:
          type: array
          items:
            $ref: '#/components/schemas/CareContextRepresentation'
          xml:
            wrapped: true
    hip:
      type: object
      required:
        - id
      properties:
        id:
          type: string
        name:
          type: string
    UsePurpose:
      type: object
      required:
        - text
        - code
      properties:
        text:
          type: string
        code:
          type: string
          description: From the fixed set, documented at refUri
        refUri:
          type: string
          format: uri
    ConsentStatus:
      type: string
      enum:
        - REQUESTED
        - EXPIRED
        - DENIED
        - GRANTED
        - ROVKED
    ConsentArtefactRepresentation:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/ConsentStatus'
        consentDetail:
          type: object
          properties:
            schemaVersion:
              type: string
              format: string
            consentId:
              type: string
              format: uuid
            createdAt:
              type: string
              format: date-time
            patient:
              $ref: '#/components/schemas/ConsentManagerPatientID'
            careContexts:
              type: array
              items:
                type: object
                required:
                  - patientReference
                  - careContextReference
                properties:
                  patientReference:
                    type: string
                    example: batman@tmh
                  careContextReference:
                    type: string
                    example: Episode1
            purpose:
              $ref: '#/components/schemas/UsePurpose'
            hip:
              type: object
              allOf:
                - $ref: '#/components/schemas/OrganizationRepresentation'
                - xml:
                    name: hip
            hiu:
              type: object
              allOf:
                - $ref: '#/components/schemas/OrganizationRepresentation'
                - xml:
                    name: hiu
            consentManager:
              type: object
              allOf:
                - $ref: '#/components/schemas/Organization'
                - xml:
                    name: consentManager
            requester:
              $ref: '#/components/schemas/Requester'
            hiTypes:
              type: array
              items:
                $ref: '#/components/schemas/HITypeEnum'
            permission:
              $ref: '#/components/schemas/Permission'
        signature:
          type: string
          example: Signature of CM as defined in W3C standards; Base64 encoded
    HealthInformationRequest:
      type: object
      required:
        - consentArtefactId
        - dataPushUrl
      properties:
        consent:
          $ref: '#/components/schemas/consent'
        dateRange:
          $ref: '#/components/schemas/dateRange'
        dataPushUrl:
          type: string
          example: 'http://localhost:8003/data/notification'
        keyMaterial:
          $ref: '#/components/schemas/keyMaterial'
    HealthInformationRequestResponse:
      type: object
      required:
        - transactionId
      properties:
        transactionId:
          type: string
    consent:
      type: object
      required:
        - id
      properties:
        id:
          type: string
    dateRange:
      type: object
      required:
        - from
        - to
      properties:
        from:
          type: string
          format: date-time
        to:
          type: string
          format: date-time
    keyMaterial:
      type: object
      required:
        - cryptoAlg
        - curve
        - DHPublicKey
        - nonce
      properties:
        cryptoAlg:
          type: string
          format: string
          example: ECDH
        curve:
          type: string
          format: string
          example: Curve25519
        dhPublicKey:
          $ref: '#/components/schemas/keyObject'
        nonce:
          type: string
          format: 32 byte string
          example: 3fa85f64-5717-4562-b3fc-2c963f66afa6
    keyObject:
      type: object
      required:
        - expiry
        - parameters
        - keyValue
      properties:
        expiry:
          type: string
          format: date-time
        parameters:
          type: string
          format: string
          example: Curve25519/32byte random key
        keyValue:
          type: string
          format: string
    MobileNumberEnquiryRequest:
      type: object
      required:
        - idenitifierType
      properties:
        identifierType:
          type: string
          enum: [MOBILE]
        identifier:
          type: string
    MobileNumberVerifyRequest:
      type: object
      required:
        - idenitifierType
      properties:
        token:
          type: string
          description: 6 digits OTP
    IdentifierEnquiryResponse:
      type: object
      properties:
        enquiryId:
          type: string
          format: uuid
        expiresIn:
          type: integer
          example: 300
          description: OTP expires in seconds.
    IdentifierVerifyResponse:
      type: object
      properties:
        temporaryToken:
          type: string
          description: JWT Token
    ConsentArtefacts:
      type: array
      items:
        $ref: '#/components/schemas/ConsentArtefactRepresentation'
    PatientProfileRepresentation:
      type: object
      properties:
        id:
          type: string
          example: user@ncg
        name:
          type: string
          example: Raj Sharma
        gender:
          $ref: '#/components/schemas/Gender'
        hasTransactionPin:
          type: boolean
        verifiedIdentifiers:
          type: array
          items:
            $ref: '#/components/schemas/IdentifierReference'
          xml:
            name: verifiedIdentifiers
            wrapped: true
          example:
            type: "MOBILE"
            value: "+91-9800083232"
        unverifiedIdentifiers:
          type: array
          items:
            $ref: '#/components/schemas/IdentifierReference'
          xml:
            name: unverifiedIdentifiers
            wrapped: true
          example:
            type: "PAN"
            value: "EEE****00J"
    IdentifierReference:
      type: object
      properties:
        type:
          $ref: '#/components/schemas/IdentifierType'
        value:
          type: string
      xml:
        name: Identifier
    IdentifierType:
      type: string
      enum: [MOBILE, PAN]
    Gender:
      type: string
      enum:
        - M
        - F
        - O
    CreatePinRequest:
      type: object
      properties:
        pin:
          type: string
          maximum: 9999
          example: "1234"
          description: '4 digit number'
      required:
        - pin
    ValidatePinRequest:
      type: object
      properties:
        pin:
          type: string
          maximum: 9999
          example: "1234"
          description: '4 digit number'
        scope:
          type: string
          enum : [consentrequest.approve, consent.revoke]
          description: 'Scope the supplied token will be valid for'
      required:
        - pin
        - scope
    CreatePatientRequest:
      type: object
      properties:
        name:
          type: string
          example: Raj Sharma
        username:
          type: string
          example: raj.sharma@ncg
        password:
          type: string
        yearOfBirth:
          type: integer
          example: 2000
        gender:
          $ref: '#/components/schemas/Gender'
      required:
        - name
        - username
        - password
        - gender
    AuthResponse:
      type: object
      properties:
        accessToken:
          type: string
          example: eyJhbGciOiJSUzI1Ni.IsInR5cCIgOiAiSldUIiwia2lkIiA6ICJrVVp.2MXJQMjRyYXN1UW9wU2lWbkdZQUZIVFowYVZGVWpYNXFLMnNibTk0In0
        expiresIn:
          type: integer
          example: 1800
          description: In Minutes
        refreshExpiresIn:
          type: integer
          example: 1800
          description: In Minutes
        refreshToken:
          type: string
          example: eyJhbGciOiJSUzI1Ni.IsInR5cCIgOiAiSldUIiwia2lkIiA6ICJrVVp.2MXJQMjRyYXN1UW9wU2lWbkdZQUZIVFowYVZGVWpYNXFLMnNibTk0In0
        tokenType:
          type: string
          example: bearer
    RevokeRequest:
      type: object
      properties:
        consents:
          type: array
          items:
            type: string
            format: uuid
          uniqueItems: true
    HINotification:
      type: object
      properties:
        transactionId:
          type: string
        consentId:
          type: string
        doneAt:
          type: string
          format: date-time
        notifier:
          type: object
          properties:
            type:
              type: string
              enum: [HIU, HIP]
            id:
              type: string
              example: tmh
        statusNotification:
          type: object
          properties:
            sessionStatus:
              type: string
              enum: [TRANSFERRED, FAILED]
            hipId:
              type: string
              example: max
            statusResponses:
              type: array
              items:
                type: object
                properties:
                  careContextReference:
                    type: string
                  hiStatus:
                    type: string
                    enum: [DELIVERED, OK, ERRORED]
                    example: OK
                  description:
                    type: string
    PatientIdentifier:
      type: object
      properties:
        type:
          $ref: '#/components/schemas/PatientIdentifierType'
        value:
          type: string
          example: "+919800083232"
      xml:
        name: Identifier
    PatientIdentifierType:
      type: string
      enum: [MOBILE, MR]
    ConsentDenyRequest:
      type: object
      properties:
        reason:
          type: string
    LogoutRequest:
      type: object
      properties:
        refreshToken:
          type: string
